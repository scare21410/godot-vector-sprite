---
title: Better curves approximation
sidebar_position: 20
---

import {GpuBezierCurveTriangle} from '@site/src/infrastructure';

As we saw in the [previous section](./approximating-curves/),
approximating curves with line segments is not ideal.
The line segments will not be smooth, and when we scale the curve,
the line segments will become more apparent.

To achieve a better approximation, we can use a different approach described in
[Rendering Vector Art on the GPU](https://developer.nvidia.com/gpugems/gpugems3/part-iv-image-effects/chapter-25-rendering-vector-art-gpu).

The algorithm allows us to draw a quadratic Bézier curve using a single triangle.
When scaling such a triangle, the curve will remain smooth.

## Enter Bézier curves

You may be familiar with Bézier curves from vector graphics software like
Adobe Illustrator or Inkscape. Those programs usually use cubic Bézier curves,
which are defined by four points.

<div className="container">
  <div className="row">
    <div className="col col--6 text--center">
      <svg
        width="200"
        height="200"
        viewBox="0 0 200 200"
        className="shadow--md primary-color"
      >
        <rect width="100%" height="100%" fill="white"/>

        {/* Cubic Bézier curve */}
        <path d="M 40,160 C 80,40 120,40 160,160" fill="none" stroke="currentColor" strokeWidth="2"/>

        {/* Control points and handles */}
        <line x1="40" y1="160" x2="80" y2="40" stroke="#999" strokeWidth="1"/>
        <line x1="160" y1="160" x2="120" y2="40" stroke="#999" strokeWidth="1"/>

        {/* Points */}
        <circle cx="40" cy="160" r="4" fill="red"/>
        <circle cx="80" cy="40" r="4" fill="red"/>
        <circle cx="120" cy="40" r="4" fill="red"/>
        <circle cx="160" cy="160" r="4" fill="red"/>

        {/* Labels */}
        <text x="30" y="180" fontSize="12">P₀</text>
        <text x="70" y="30" fontSize="12">P₁</text>
        <text x="130" y="30" fontSize="12">P₂</text>
        <text x="170" y="180" fontSize="12">P₃</text>
      </svg>
      <p>Cubic Bézier curve</p>
    </div>
    <div className="col col--6 text--center">
      <svg
        width="200"
        height="200"
        viewBox="0 0 200 200"
        className="shadow--md primary-color"
      >
        <rect width="100%" height="100%" fill="white"/>

        {/* Cubic Bézier curve (self-intersecting with a loop) */}
        <path d="M 80,150 C 160,50 40,50 120,150" fill="none" stroke="currentColor" strokeWidth="2"/>

        {/* Control points and handles */}
        <line x1="80" y1="150" x2="160" y2="50" stroke="#999" strokeWidth="1"/>
        <line x1="120" y1="150" x2="40" y2="50" stroke="#999" strokeWidth="1"/>

        {/* Points */}
        <circle cx="80" cy="150" r="4" fill="red"/>
        <circle cx="160" cy="50" r="4" fill="red"/>
        <circle cx="40" cy="50" r="4" fill="red"/>
        <circle cx="120" cy="150" r="4" fill="red"/>

        {/* Labels */}
        <text x="70" y="170" fontSize="12">P₀</text>
        <text x="170" y="45" fontSize="12">P₁</text>
        <text x="30" y="45" fontSize="12">P₂</text>
        <text x="120" y="170" fontSize="12">P₃</text>
      </svg>
      <p>Cubic Bézier curve (self-intersecting)</p>
    </div>
  </div>
</div>

This provides great flexibility, but processing cubic Bézier curves on GPU is not trivial.
One problem is that the curve can be self-intersecting, as shown above,
which requires additional processing to render correctly.

On the other hand, quadratic Bézier curves are simpler to process and cannot self intersect.
This makes them a great choice for rendering vector graphics on the GPU.

<div className="text--center">
  <svg width="200" height="200" xmlns="http://www.w3.org/2000/svg" className="shadow--md primary-color">
    <rect width="100%" height="100%" fill="white"/>

    {/* Control triangle */}
    <polygon points="20,180 180,20 180,180" fill="none" stroke="gray" strokeDasharray="5,5"/>

    {/* Bezier curve */}
    <path d="M20,180 Q180,20 180,180" fill="currentColor"/>

    {/* Points */}
    <circle cx="20" cy="180" r="4" fill="red"/>
    <circle cx="180" cy="20" r="4" fill="red"/>
    <circle cx="180" cy="180" r="4" fill="red"/>

    {/* Labels */}
    <text x="10" y="195" fontSize="14" fill="black">P₀</text>
    <text x="185" y="15" fontSize="14" fill="black">P₁</text>
    <text x="185" y="195" fontSize="14" fill="black">P₂</text>
  </svg>
  <p>Quadratic Bézier curve</p>
</div>

## GPU rendering

The algorithm described in the [GPU Gems article](https://developer.nvidia.com/gpugems/gpugems3/part-iv-image-effects/chapter-25-rendering-vector-art-gpu)
uses a single triangle to render a quadratic Bézier curve. The triangle is defined by the
start point $P_0$, the control point $P_1$, and the end point $P_2$.

<div className="container">
  <div className="row">
    <div className="col col--6 text--center">
      <GpuBezierCurveTriangle
        className="shadow--md"
        width={200}
        height={200}
        p0={{x: 20, y: 180}}
        p1={{x: 180, y: 20}}
        p2={{x: 180, y: 180}}
      />
      <p>GPU rendered quadratic Bézier curve</p>
    </div>
    <div className="col col--6 text--center">
      <GpuBezierCurveTriangle
        className="shadow--md"
        width={200}
        height={200}
        viewBox={[125, 90, 25, 25]}
        p0={{x: 20, y: 180}}
        p1={{x: 180, y: 20}}
        p2={{x: 180, y: 180}}
      />
      <p>GPU rendered quadratic Bézier curve (8x zoom)</p>
    </div>
  </div>
</div>

## Little math never killed nobody

We'll be doing crazy math stuff with quadratic Bézier curves, therefore we need to
define them mathematically.

A quadratic Bézier curve is defined by three points the start point $P_0$,
the control point $P_1$, and the end point $P_2$. The curve starts at the start point
and ends at the end point, but it does not pass through the control point.

The curve is defined by the following equation:

$$
B(t) = (1 - t)^2 P_0 + 2(1 - t)t P_1 + t^2 P_2
$$

where:
- $B(t)$ is the point on the curve at time $t$,
- $P_0$ is the start point,
- $P_1$ is the control point
- $P_2$ is the endpoint
- $t$ is the time parameter.

The curve is defined for $0 \leq t \leq 1$.

We can see that if we set $t = 0$, we get the start point $B(0) = P_0$.

If we set $t = 1$, we get the end point $B(1) = P_2$.

In the middle at $t = 0.5$, we see that $B(0.5) = 0.25 P_0 + 0.5 P_1 + 0.25 P_2$.
